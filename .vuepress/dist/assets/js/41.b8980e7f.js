(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{349:function(e,a,t){"use strict";t.r(a);var r=t(1),o=Object(r.a)({},(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"garbage-collection"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#garbage-collection","aria-hidden":"true"}},[e._v("#")]),e._v(" Garbage Collection")]),e._v(" "),t("blockquote",[t("p",[e._v("Posted: 09.25.2019")])]),e._v(" "),t("Tag"),e._v(" "),t("h2",{attrs:{id:"description"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#description","aria-hidden":"true"}},[e._v("#")]),e._v(" Description")]),e._v(" "),t("p",[e._v("People who learned C++ know that we have to deallocate memory after memory allocation.")]),e._v(" "),t("p",[e._v("Java has garbage collector, which will do this kind of work automatically.")]),e._v(" "),t("p",[e._v("JS does too.")]),e._v(" "),t("p",[e._v("JS has two garbage collection algorithms.")]),e._v(" "),t("h2",{attrs:{id:"mark-and-sweep-algorithm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mark-and-sweep-algorithm","aria-hidden":"true"}},[e._v("#")]),e._v(" Mark-and-Sweep Algorithm")]),e._v(" "),t("blockquote",[t("p",[e._v("Starting 2012, all modern browsers use this algorithm for garbage collection")])]),e._v(" "),t("p",[e._v("The algorithm is basically DFS/BFS.")]),e._v(" "),t("p",[e._v("During each cycle, do the following work:")]),e._v(" "),t("ol",[t("li",[e._v("Starting at the global object (window for browser and global for Node)")]),e._v(" "),t("li",[e._v("Apply BFS/DFS to the global object, mark all nodes that have a reference from and to")]),e._v(" "),t("li",[e._v("At the end of the iteration, all objects being referenced are marked and all unreachable objects are not marked")]),e._v(" "),t("li",[e._v("Clear all unmarked objects from memory")])]),e._v(" "),t("p",[t("img",{attrs:{src:"/mark-sweep.png",alt:"mark and sweep"}})]),e._v(" "),t("h2",{attrs:{id:"reference-count-algorithm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#reference-count-algorithm","aria-hidden":"true"}},[e._v("#")]),e._v(" Reference Count Algorithm")]),e._v(" "),t("blockquote",[t("p",[e._v("This is the inital algorithm for garbage collection, but has severe problems")])]),e._v(" "),t("p",[e._v("Key Idea: track the number of references each object has")]),e._v(" "),t("ul",[t("li",[e._v("When declaring a variable and assign it to a reference type, it's reference count is 1")]),e._v(" "),t("li",[e._v("On this variable is assigned to another address, the reference count of previosu object -1")]),e._v(" "),t("li",[e._v("When an object has reference count 0, then it means we cannot access it, so we need to deallocate it.\n"),t("ul",[t("li",[e._v("At the beginning of next cycle, garbage collector will release their memory")])])])]),e._v(" "),t("p",[t("span",{staticStyle:{color:"palevioletred"}},[e._v("The Problem is, doubly referencing!!!")])]),e._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[e._v("objA"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("someOtherObject "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" objB"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\nobjB"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("anotherObject "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" objA"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("In above code, objA and objB reference each other, which means their count will never be 0.")]),e._v(" "),t("p",[e._v("When objA and objB leaves the scope and the function finishes execution, they will still exist, because their reference count is not 0, garbage collector will not remove them!!!")]),e._v(" "),t("p",[e._v("Then memory leak occurs!!!")]),e._v(" "),t("h2",{attrs:{id:"reference"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#reference","aria-hidden":"true"}},[e._v("#")]),e._v(" Reference")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Memory_Management",target:"_blank",rel:"noopener noreferrer"}},[e._v("Garbage collection"),t("OutboundLink")],1)]),e._v(" "),t("p",[t("a",{attrs:{href:"https://javascript.info/garbage-collection",target:"_blank",rel:"noopener noreferrer"}},[e._v("Garbage collection"),t("OutboundLink")],1)]),e._v(" "),t("p",[t("a",{attrs:{href:"https://www.cnblogs.com/zhwl/p/4664604.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("JavaScript垃圾回收机制"),t("OutboundLink")],1)])],1)}),[],!1,null,null,null);a.default=o.exports}}]);